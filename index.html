<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8" /> <meta name="viewport" content="width=device-width,initial-scale=1" /> <title>DumboAS â€” Pro</title> <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"> <style> :root {   --bg-app: #0d0d0d;   --bg-sidebar: #000000;   --bg-input: #1a1a1a;   --bg-modal: #141414;   --text-main: #e0e0e0;   --text-muted: #888888;   --accent: #10a37f;   --border: rgba(255,255,255,0.08);   --bubble-user: #262626; }  * { box-sizing: border-box; outline: none; } html, body { height: 100%; margin: 0; font-family: -apple-system, system-ui, sans-serif; background-color: var(--bg-app); color: var(--text-main); overflow: hidden; }  /* Auth & Modal Styles */ #authOverlay { position: fixed; inset: 0; background: #000; z-index: 2000; display: flex; align-items: center; justify-content: center; } .auth-card { background: var(--bg-modal); border: 1px solid var(--border); padding: 40px; border-radius: 12px; width: 360px; text-align: center; } .auth-input { width: 100%; padding: 12px; margin: 8px 0; border-radius: 6px; border: 1px solid #333; background: #000; color: #fff; } .auth-btn { width: 100%; padding: 12px; background: #fff; color: #000; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; margin-top: 10px; } .auth-toggle { margin-top: 15px; font-size: 13px; color: var(--text-muted); } .auth-toggle span { color: #fff; cursor: pointer; text-decoration: underline; }  #modalOverlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 3000; display: none; align-items: center; justify-content: center; } .modal-card { background: var(--bg-modal); border: 1px solid var(--border); padding: 24px; border-radius: 12px; width: 450px; } .modal-input { width: 100%; min-height: 100px; background: #000; border: 1px solid #333; color: #fff; padding: 12px; border-radius: 8px; resize: vertical; margin-bottom: 16px; font-family: inherit; } .modal-actions { display: flex; justify-content: flex-end; gap: 12px; } .btn-cancel { background: transparent; border: 1px solid #333; color: #fff; padding: 8px 16px; border-radius: 6px; cursor: pointer; } .btn-save { background: var(--accent); border: none; color: #fff; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 500; }  /* Layout */ .container { display: none; grid-template-columns: 260px 1fr; height: 100vh; } .sidebar { background: var(--bg-sidebar); border-right: 1px solid var(--border); display: flex; flex-direction: column; padding: 10px; height: 100%; } .new-chat { border: 1px solid var(--border); padding: 10px; border-radius: 6px; cursor: pointer; font-size: 14px; margin-bottom: 15px; text-align: center; transition: 0.2s; } .new-chat:hover { background: #111; border-color: #333; } .conv-list { flex: 1; overflow-y: auto; } .conv-item { padding: 12px 10px; border-radius: 6px; font-size: 13px; color: var(--text-muted); cursor: pointer; display: flex; justify-content: space-between; align-items: center; margin-bottom: 2px; } .conv-item:hover, .conv-item.active { background: #1a1a1a; color: #fff; } .conv-actions { display: none; gap: 10px; } .conv-item:hover .conv-actions { display: flex; } .conv-item i { font-size: 12px; padding: 4px; }  .warning-box { font-size: 11px; color: #ff4d4d; padding: 10px; border: 1px solid #ff4d4d; border-radius: 8px; margin-bottom: 10px; line-height: 1.4; border-style: dashed; background: rgba(255, 77, 77, 0.05); }  .sidebar-footer { margin-top: auto; padding: 10px; border-top: 1px solid #111; display: flex; align-items: center; justify-content: space-between; } .logout-btn { cursor: pointer; color: #666; font-size: 14px; transition: 0.2s; } .logout-btn:hover { color: #ff4d4d; }  .main { display: flex; flex-direction: column; height: 100vh; position: relative; overflow: hidden; } .main-header { padding: 14px 20px; border-bottom: 1px solid var(--border); font-weight: 700; font-size: 16px; color: #fff; display: flex; align-items: center; justify-content: space-between; flex-shrink: 0; }  .chat-window { flex: 1; overflow-y: auto; padding: 20px 0; display: flex; flex-direction: column; align-items: center; scroll-behavior: smooth; position: relative; }  /* Sticky Input Area */ .input-area { flex-shrink: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; background: linear-gradient(0deg, var(--bg-app) 70%, transparent 100%); z-index: 10; } .input-box { width: 100%; max-width: 750px; background: var(--bg-input); border: 1px solid var(--border); border-radius: 12px; padding: 12px; position: relative; } .input-row { display: flex; align-items: flex-end; gap: 10px; } textarea { flex: 1; background: transparent; border: none; color: #fff; resize: none; font-size: 15px; max-height: 180px; padding: 6px 0; line-height: 1.4; } .input-actions { display: flex; align-items: center; gap: 12px; margin-top: 10px; }  .action-btn { background: transparent; border: 1px solid var(--border); width: 32px; height: 32px; border-radius: 50%; color: var(--text-muted); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.2s; } .action-btn:hover { color: #fff; border-color: #444; } .action-btn.active { color: var(--accent); border-color: var(--accent); }  .send-btn { background: #fff; border: none; width: 32px; height: 32px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.2s; flex-shrink: 0; color: #000; } .send-btn:hover:not(:disabled) { transform: scale(1.05); } .send-btn:disabled { opacity: 0.2; }  /* Mode Menu */ .mode-menu { position: absolute; bottom: 60px; left: 12px; background: var(--bg-modal); border: 1px solid var(--border); border-radius: 8px; padding: 5px; display: none; flex-direction: column; z-index: 100; box-shadow: 0 8px 24px rgba(0,0,0,0.5); width: 230px; max-height: 450px; overflow-y: auto; } .mode-opt { padding: 10px 12px; font-size: 12px; cursor: pointer; color: var(--text-muted); border-radius: 4px; display: flex; flex-direction: column; } .mode-opt span.label { font-weight: 600; font-size: 13px; color: #fff; } .mode-opt span.desc { font-size: 11px; opacity: 0.7; } .mode-opt:hover { color: #fff; background: #222; } .mode-opt.active { color: var(--accent); background: rgba(16, 163, 127, 0.1); } .mode-opt.active span.label { color: var(--accent); }  /* Attachment Preview */ .attachment-preview { display: none; align-items: center; gap: 8px; background: #000; padding: 6px 12px; border-radius: 8px; margin-bottom: 8px; font-size: 12px; border: 1px solid var(--accent); } .attachment-preview.active { display: flex; }  /* Messages */ .message { width: 90%; max-width: 750px; margin-bottom: 40px; display: flex; flex-direction: column; position: relative; } .message.user { align-items: flex-end; } .message.ai { align-items: flex-start; } .bubble { padding: 12px 16px; border-radius: 14px; line-height: 1.5; font-size: 15px; max-width: 85%; white-space: pre-wrap; word-wrap: break-word; position: relative; } .bubble.user { background: var(--bubble-user); color: #fff; } .bubble.ai { background: transparent; color: #ececec; }  /* TOOLBAR */ .msg-tools { position: absolute; bottom: -45px; display: none; gap: 12px; font-size: 13px; color: #555; padding: 20px 0; min-height: 60px; align-items: center; } .message:hover .msg-tools { display: flex; } .tool-btn { cursor: pointer; transition: 0.2s; padding: 6px; } .tool-btn:hover { color: #fff; }  .attachment-in-msg { margin-top: 8px; border-radius: 8px; max-width: 200px; display: block; border: 1px solid #333; } .generated-image { margin-top: 12px; border-radius: 12px; max-width: 100%; border: 1px solid var(--border); box-shadow: 0 4px 12px rgba(0,0,0,0.3); background: #000; }  #scrollBottomBtn { position: absolute; bottom: 160px; right: 20px; width: 35px; height: 35px; border-radius: 50%; background: var(--bg-input); border: 1px solid var(--border); color: #fff; cursor: pointer; display: none; align-items: center; justify-content: center; z-index: 5; }  /* Suggestion Buttons */ .suggestions-container { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 12px; width: 100%; max-width: 750px; } .suggestion-chip { background: var(--bg-input); border: 1px solid var(--border); padding: 8px 14px; border-radius: 16px; font-size: 13px; cursor: pointer; transition: 0.2s; color: var(--text-muted); } .suggestion-chip:hover { border-color: var(--accent); color: #fff; }  /* Thinking */ .thought-box { display: flex; align-items: center; gap: 8px; color: #666; font-size: 13px; margin-bottom: 8px; } .thought-dot { width: 4px; height: 4px; background: #666; border-radius: 50%; animation: blink 1.4s infinite both; } .thought-dot:nth-child(2) { animation-delay: 0.2s; } .thought-dot:nth-child(3) { animation-delay: 0.4s; } @keyframes blink { 0% { opacity: 0.2; } 20% { opacity: 1; } 100% { opacity: 0.2; } } </style> </head> <body>  <div id="authOverlay">   <div class="auth-card">     <div style="font-size:24px; font-weight:bold; margin-bottom:8px">DumboAS Pro</div>     <div id="authSubTitle" style="font-size:14px; color:var(--text-muted); margin-bottom:20px">Sign in</div>     <form id="authForm">       <input type="text" id="username" class="auth-input" placeholder="Username" required />       <input type="password" id="password" class="auth-input" placeholder="Password" required />       <button type="submit" class="auth-btn" id="authSubmitBtn">Enter</button>     </form>     <div class="auth-toggle">         <span id="authToggleText" onclick="toggleAuthMode()">New here? Sign Up</span>     </div>   </div> </div>  <div id="modalOverlay">   <div class="modal-card">     <h3 id="modalTitle" style="margin:0 0 16px 0; font-size:18px">Action</h3>     <textarea id="modalTextArea" class="modal-input"></textarea>     <div class="modal-actions">       <button class="btn-cancel" onclick="closeModal()">Cancel</button>       <button class="btn-save" id="modalConfirmBtn">Confirm</button>     </div>   </div> </div>  <div class="container" id="app">   <aside class="sidebar">     <div class="new-chat" onclick="newChat()"><i class="fas fa-plus"></i></div>     <div class="conv-list" id="convList"></div>     <div class="warning-box">       <b>Warning:</b> Dumbo can make Dumbo-mistakes.     </div>     <div class="sidebar-footer">         <div style="font-size:12px; color:var(--text-muted)" id="userDisplay"></div>         <div class="logout-btn" onclick="logout()"><i class="fas fa-sign-out-alt"></i></div>     </div>   </aside>      <main class="main">     <div class="main-header">         <span>DumboAS Pro</span>         <div id="modeStatus" style="font-size: 11px; color: var(--text-muted); text-transform: uppercase;">Mode: Think</div>     </div>          <div id="chatWindow" class="chat-window"></div>     <div id="suggestionArea" style="width: 100%; display: flex; justify-content: center; padding-bottom: 10px;"></div>     <button id="scrollBottomBtn" onclick="scrollToEnd()"><i class="fas fa-arrow-down"></i></button>          <div class="input-area">       <div id="attachmentPreview" class="attachment-preview">           <i class="fas fa-file"></i> <span id="fileNameDisplay">file.png</span>           <i class="fas fa-times" style="margin-left:auto; cursor:pointer" onclick="clearAttachment()"></i>       </div>       <div class="input-box">         <div class="input-row">           <textarea id="userInput" rows="1" placeholder="Type a message..."></textarea>           <button id="sendBtn" class="send-btn" disabled><i class="fas fa-arrow-up"></i></button>         </div>         <div class="input-actions">           <div style="position:relative">               <button class="action-btn" onclick="toggleModes()"><i class="fas fa-bolt"></i></button>               <div class="mode-menu" id="modeMenu">                 <div class="mode-opt active" id="opt-think" onclick="setMode('think')">                     <span class="label">Think</span>                     <span class="desc">Standard high-intel reasoning</span>                 </div>                 <div class="mode-opt" id="opt-dumbo" onclick="setMode('dumbo')">                     <span class="label">Dumbo</span>                     <span class="desc">The classic DumboAS personality</span>                 </div>                 <div class="mode-opt" id="opt-deep-dive" onclick="setMode('deep-dive')">                     <span class="label">Deep Dive <span id="ddLimitDisplay">25/25</span></span>                     <span class="desc">Extreme intelligence & logic (25 / 3h)</span>                 </div>                 <div class="mode-opt" id="opt-extra-dumbo" onclick="setMode('extra-dumbo')">                     <span class="label">Extra-Dumbo</span>                     <span class="desc">Max persona, max friendliness</span>                 </div>                 <div class="mode-opt" id="opt-less-dumbo" onclick="setMode('less-dumbo')">                     <span class="label">Less-Dumbo</span>                     <span class="desc">Tone down the circus act</span>                 </div>                 <div class="mode-opt" id="opt-chill" onclick="setMode('chill')">                     <span class="label">Chill</span>                     <span class="desc">Zero attitude, relaxed response</span>                 </div>                 <div class="mode-opt" id="opt-code-crafter" onclick="setMode('code-crafter')">                     <span class="label">Code Crafter</span>                     <span class="desc">Elite scripting & advanced dev knowledge</span>                 </div>                 <div class="mode-opt" id="opt-simple" onclick="setMode('simple')">                     <span class="label">Simple</span>                     <span class="desc">No complex words, easy for anyone</span>                 </div>                 <div class="mode-opt" id="opt-research" onclick="setMode('research')">                     <span class="label">Research</span>                     <span class="desc">Deep web browsing & analysis</span>                 </div>                 <div class="mode-opt" id="opt-image" onclick="setMode('image')">                     <span class="label">Image Gen</span>                     <span class="desc">Generate professional visuals</span>                 </div>                 <div class="mode-opt" id="opt-quiz-solver" onclick="setMode('quiz-solver')">                     <span class="label">Quiz Solver</span>                     <span class="desc">Search & solve quizzes (Safety first)</span>                 </div>                 <div class="mode-opt" id="opt-boredom-solver" onclick="setMode('boredom-solver')">                     <span class="label">Boredom Solver</span>                     <span class="desc">Fun quizzes & challenges</span>                 </div>                 <div class="mode-opt" id="opt-jokingly-dumbo" onclick="setMode('jokingly-dumbo')">                     <span class="label">Jokingly-Dumbo</span>                     <span class="desc">Dumb, funny, and chaotic</span>                 </div>                 <div class="mode-opt" id="opt-scripting" onclick="setMode('scripting')">                     <span class="label">Scripting</span>                     <span class="desc">Code & Software Architecture</span>                 </div>                 <div class="mode-opt" id="opt-not" onclick="setMode('not')">                     <span class="label">Not-Dumbo</span>                     <span class="desc">Pure technical objective mode</span>                 </div>               </div>           </div>           <button class="action-btn" onclick="triggerFileUpload()"><i class="fas fa-paperclip"></i></button>           <input type="file" id="fileInput" hidden onchange="handleFileSelect(event)">         </div>       </div>     </div>   </main> </div>  <script> const apiKey = "";   // --- Storage & Limits --- const DB_NAME = 'dumbo_pro_v23'; const USERS_DB = 'dumbo_users_v23'; const LIMITS_DB = 'dumbo_limits_v23';  function getDDLimit() {     const limits = JSON.parse(localStorage.getItem(LIMITS_DB) || '{}');     const userLimit = limits[activeUser] || { count: 25, lastReset: Date.now() };     if (Date.now() - userLimit.lastReset > 3 * 60 * 60 * 1000) {         userLimit.count = 25;         userLimit.lastReset = Date.now();         localStorage.setItem(LIMITS_DB, JSON.stringify({ ...limits, [activeUser]: userLimit }));     }     return userLimit; }  function useDD() {     const limits = JSON.parse(localStorage.getItem(LIMITS_DB) || '{}');     const userLimit = getDDLimit();     if (userLimit.count > 0) {         userLimit.count--;         localStorage.setItem(LIMITS_DB, JSON.stringify({ ...limits, [activeUser]: userLimit }));         updateLimitDisplay();         return true;     }     return false; }  function updateLimitDisplay() {     const lim = getDDLimit();     const el = document.getElementById('ddLimitDisplay');     if (el) el.textContent = `${lim.count}/25`; }  // --- Utils --- function filterSwears(text) {     const swears = ['fuck', 'shit', 'ass', 'bitch', 'cunt', 'dick'];     const lower = text.toLowerCase();     const hasSwear = swears.some(s => lower.includes(s));     return hasSwear ? "Swearing isn't cool! " : ""; }  async function apiFetch(url, body) {   const delays = [1000, 2000, 4000, 8000, 16000];   for (let i = 0; i < delays.length; i++) {     try {       const fullUrl = url.includes('?') ? `${url}&key=${apiKey}` : `${url}?key=${apiKey}`;       const response = await fetch(fullUrl, {         method: "POST",         headers: { "Content-Type": "application/json" },         body: JSON.stringify(body)       });       if (response.ok) return await response.json();       throw new Error(`Status ${response.status}`);     } catch (e) {       if (i === delays.length - 1) throw e;       await new Promise(r => setTimeout(r, delays[i]));     }   } }  async function generateVoice(text) {     if (!text) return;     try {         const url = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent";         const data = await apiFetch(url, {             contents: [{ parts: [{ text: `Say clearly: ${text}` }] }],             generationConfig: {                  responseModalities: ["AUDIO"],                  speechConfig: { voiceConfig: { prebuiltVoiceConfig: { voiceName: "Kore" } } }              },             model: "gemini-2.5-flash-preview-tts"         });         const pcmData = data.candidates[0].content.parts[0].inlineData.data;         const audioBlob = pcmToWavBlob(pcmData, 24000);          new Audio(URL.createObjectURL(audioBlob)).play();     } catch (e) { console.error("TTS failed", e); } }  function pcmToWavBlob(base64, sampleRate) {     const buffer = Uint8Array.from(atob(base64), c => c.charCodeAt(0)).buffer;     const wavHeader = new ArrayBuffer(44);     const view = new DataView(wavHeader);     const length = buffer.byteLength;     view.setUint32(0, 0x46464952, true); view.setUint32(4, 36 + length, true); view.setUint32(8, 0x45564157, true);     view.setUint32(12, 0x20746d66, true); view.setUint32(16, 16, true); view.setUint16(20, 1, true);     view.setUint16(22, 1, true); view.setUint32(24, sampleRate, true); view.setUint32(28, sampleRate * 2, true);     view.setUint16(32, 2, true); view.setUint16(34, 16, true); view.setUint32(36, 0x61746164, true); view.setUint32(40, length, true);     return new Blob([wavHeader, buffer], { type: 'audio/wav' }); }  async function generateImage(prompt) {     try {         const url = "https://generativelanguage.googleapis.com/v1beta/models/imagen-4.0-generate-001:predict";         const data = await apiFetch(url, { instances: { prompt: prompt }, parameters: { sampleCount: 1 } });         return `data:image/png;base64,${data.predictions[0].bytesBase64Encoded}`;     } catch (e) { return null; } }  async function callGemini(prompt, sys, fileData = null, useSearch = false, isJson = false) {     try {         const url = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent";         const parts = [{ text: prompt }];         if (fileData) {             if (fileData.type.startsWith('image/')) {                 parts.push({ inlineData: { mimeType: fileData.type, data: fileData.base64 } });             } else {                 parts[0].text += `\n\nATTACHED FILE CONTENT [${fileData.name}]:\n${fileData.data}`;             }         }                  const config = {};         if (isJson) {             config.responseMimeType = "application/json";         }          const data = await apiFetch(url, {             contents: [{ role: "user", parts }],             systemInstruction: { parts: [{ text: sys }] },             tools: useSearch ? [{ "google_search": {} }] : undefined,             generationConfig: isJson ? config : undefined         });         return data.candidates?.[0]?.content?.parts?.[0]?.text || "";     } catch (e) {         return `Error: ${e.message}. Brain is currently syncing.`;     } }  // --- App State --- let isSignup = false; let activeUser = localStorage.getItem('dumbo_session'); let chatData = JSON.parse(localStorage.getItem(DB_NAME) || '{}'); let users = JSON.parse(localStorage.getItem(USERS_DB) || '{}'); let currentConvId = null; let currentMode = 'think'; let currentFile = null;  const chatWindow = document.getElementById('chatWindow'); const userInput = document.getElementById('userInput'); const sendBtn = document.getElementById('sendBtn'); const scrollBottomBtn = document.getElementById('scrollBottomBtn'); const fileInput = document.getElementById('fileInput'); const attachmentPreview = document.getElementById('attachmentPreview'); const modalOverlay = document.getElementById('modalOverlay'); const modalTextArea = document.getElementById('modalTextArea'); const suggestionArea = document.getElementById('suggestionArea');  function scrollToEnd() { chatWindow.scrollTo({ top: chatWindow.scrollHeight, behavior: 'smooth' }); } function save() { localStorage.setItem(DB_NAME, JSON.stringify(chatData)); } function toggleModes() {      const m = document.getElementById('modeMenu');      m.style.display = m.style.display === 'flex' ? 'none' : 'flex';      updateLimitDisplay(); } function closeModal() { modalOverlay.style.display = 'none'; }  function deleteConv(id, e) {     e.stopPropagation();     delete chatData[activeUser][id];     if (currentConvId === id) {         const remaining = Object.keys(chatData[activeUser]);         if (remaining.length) selectConv(remaining[0]);         else newChat();     }     save(); renderSidebar(); }  function renameConv(id, e) {     e.stopPropagation();     const chat = chatData[activeUser][id];     modalTextArea.value = chat.title;     document.getElementById('modalTitle').textContent = "Rename Chat";     modalOverlay.style.display = 'flex';     document.getElementById('modalConfirmBtn').onclick = () => {         chat.title = modalTextArea.value || "Untitled";         save(); renderSidebar(); closeModal();     }; }  function deleteMsg(idx) {     chatData[activeUser][currentConvId].messages.splice(idx, 1);     save(); renderChat(); }  function editMsg(idx) {     const msg = chatData[activeUser][currentConvId].messages[idx];     modalTextArea.value = msg.text;     document.getElementById('modalTitle').textContent = "Edit Message";     modalOverlay.style.display = 'flex';     document.getElementById('modalConfirmBtn').onclick = () => {         msg.text = modalTextArea.value;         chatData[activeUser][currentConvId].messages.splice(idx + 1);          save();         closeModal();         handleSend(true);      }; }  /** âœ¨ GEMINI FEATURE: Generate smart titles */ async function generateSmartTitle(convId) {     const chat = chatData[activeUser][convId];     if (!chat || chat.messages.length < 2) return;     const history = chat.messages.slice(0, 4).map(m => `${m.role}: ${m.text}`).join('\n');     const prompt = `Summarize this chat in 4 words or less for a sidebar title. Context:\n${history}`;     const title = await callGemini(prompt, "You are a creative title generator. Return only the title text.");     if (title && !title.startsWith("Error")) {         chat.title = title.replace(/["']/g, "").trim();         save();         renderSidebar();     } }  /** âœ¨ GEMINI FEATURE: Suggest next actions */ async function suggestNext() {     const chat = chatData[activeUser][currentConvId];     if (!chat || chat.messages.length === 0) return;          suggestionArea.innerHTML = `<div class="thought-box" style="font-size:11px">âœ¨ Generating ideas...</div>`;          const history = chat.messages.slice(-6).map(m => `${m.role}: ${m.text}`).join('\n');     const prompt = `Based on our chat history, suggest 3 short, creative follow-up messages I might want to send next. Return them as a JSON array of strings called "suggestions". History:\n${history}`;          try {         const response = await callGemini(prompt, "You are a helpful assistant. Output JSON only.", null, false, true);         const data = JSON.parse(response);         renderSuggestions(data.suggestions || []);     } catch (e) {         suggestionArea.innerHTML = "";     } }  function renderSuggestions(list) {     suggestionArea.innerHTML = "";     const container = document.createElement('div');     container.className = "suggestions-container";     list.forEach(text => {         const chip = document.createElement('div');         chip.className = "suggestion-chip";         chip.textContent = text;         chip.onclick = () => {             userInput.value = text;             userInput.style.height = 'auto';             userInput.style.height = userInput.scrollHeight + 'px';             sendBtn.disabled = false;             suggestionArea.innerHTML = "";             handleSend();         };         container.appendChild(chip);     });     suggestionArea.appendChild(container); }  async function handleSend(isRewrite = false) {     let val = isRewrite ? "" : userInput.value.trim();     if (!val && !currentFile && !isRewrite) return;      if (currentMode === 'deep-dive') {         if (!useDD()) {             alert("Deep Dive limit reached (25 per 3 hours). Resetting soon!");             return;         }     }      if (!isRewrite) {         const userMsg = { role: 'user', text: val, file: currentFile };         chatData[activeUser][currentConvId].messages.push(userMsg);         userInput.value = ''; userInput.style.height = 'auto';         suggestionArea.innerHTML = "";     }      const chat = chatData[activeUser][currentConvId];     if (!chat.title || chat.title === 'New chat') {         chat.title = (chat.messages[0].text || "Attachment").slice(0, 30);         renderSidebar();     }      const fileToUpload = currentFile;     const userPrompt = chat.messages.filter(m => m.role === 'user').pop().text;     const swearPrefix = filterSwears(userPrompt);      clearAttachment();     save(); renderChat();      const aiMsgObj = { role: 'ai', text: '', thinking: true };     chat.messages.push(aiMsgObj);     renderChat();     sendBtn.disabled = true;      if (currentMode === 'image') {         const imgUrl = await generateImage(userPrompt);         aiMsgObj.text = swearPrefix + (imgUrl ? "Here is the generated image." : "Generation failed.");         aiMsgObj.image = imgUrl;         aiMsgObj.thinking = false;         save(); renderChat();         sendBtn.disabled = false;         return;     }      const sys = `Name: DumboAS Pro. IDENTITY: Friendly, professional expert.     KNOWLEDGE: Image Generation, Research (Search), and Multi-mode intelligence.          STYLE GUIDELINES:     - DO NOT use money symbols ($, Â£, â‚¬) randomly or as punctuation. Only use them for actual currency values.     - Use emojis sparingly and naturally to keep the vibe friendly. ðŸ˜âœ¨          MODES:      - THINK: Standard balanced mode.     - DUMBO: The classic DumboAS personality - high energy, helpful, and circus-themed.     - CHILL: No attitude, no colorful metaphors. Just a relaxed, helpful, and laid-back assistant.     - CODE CRAFTER: Deep technical expertise. Use advanced knowledge from all sources to write high-performance, complex code and scripts.     - SIMPLE: Use very basic language. No big or unknown words. Friendly and easy to understand for anyone.     - DEEP DIVE: Maximum possible intelligence. Thorough and elite.     - EXTRA-DUMBO: Lean heavily into the "Dumbo" persona. Be extremely friendly, enthusiastic, and use circus/elephant metaphors.     - LESS-DUMBO: Tone down the persona. Be more direct and less colorful, but still helpful.     - RESEARCH: Use Google Search to find real data.     - QUIZ SOLVER: Research-based solver. HUMAN SAFETY PRIORITY.     - BOREDOM SOLVER: Interactive quizzes/challenges.     - JOKINGLY-DUMBO: Intentionally silly and funny.     - SCRIPTING: Technical code expert.     - NOT-DUMBO: Cold, scientific brilliance.          Current active logic-filter: ${currentMode.toUpperCase()}.`;      const useSearch = (currentMode === 'research' || currentMode === 'quiz-solver');     const context = chat.messages.slice(0, -1).map(m => `${m.role}: ${m.text}`).join("\n");     let response = await callGemini(context, sys, fileToUpload, useSearch);          aiMsgObj.text = swearPrefix + response;     aiMsgObj.thinking = false;     save(); renderChat();     sendBtn.disabled = false;      // âœ¨ Run background Gemini tasks     if (chat.messages.length === 2) generateSmartTitle(currentConvId); }  // Global reference for voice synthesis window._speak = function(idx) {     const msgs = chatData[activeUser][currentConvId]?.messages || [];     if (msgs[idx]) generateVoice(msgs[idx].text); };  function renderChat() {     chatWindow.innerHTML = '';     const msgs = chatData[activeUser][currentConvId]?.messages || [];     msgs.forEach((m, i) => {         const div = document.createElement('div');         div.className = `message ${m.role}`;         if (m.thinking) {             div.innerHTML = `<div class="thought-box">Processing...<div class="thought-dot"></div><div class="thought-dot"></div><div class="thought-dot"></div></div><div class="bubble ai">...</div>`;         } else {             let inner = `<div class="bubble ${m.role}">${m.text}</div>`;             if (m.file && m.file.type.startsWith('image/')) {                 inner = `<img src="${m.file.data}" class="attachment-in-msg">` + inner;             } else if (m.file) {                 inner = `<div class="attachment-in-msg" style="background:#111; padding:8px; font-size:11px"><i class="fas fa-file-alt"></i> ${m.file.name}</div>` + inner;             }             if (m.image) inner += `<img src="${m.image}" class="generated-image">`;                          let tools = `<div class="msg-tools">`;             if (m.role === 'user') tools += `<i class="fas fa-edit tool-btn" onclick="editMsg(${i})" title="Edit"></i>`;             if (m.role === 'ai') {                 tools += `<i class="fas fa-volume-up tool-btn" onclick="window._speak(${i})" title="Listen"></i>`;                 tools += `<i class="fas fa-lightbulb tool-btn" onclick="suggestNext()" title="âœ¨ Suggest Next"></i>`;             }             tools += `<i class="fas fa-trash tool-btn" onclick="deleteMsg(${i})" title="Delete"></i></div>`;                          div.innerHTML = inner + tools;         }         chatWindow.appendChild(div);     });     scrollToEnd(); }  function triggerFileUpload() { fileInput.click(); } function handleFileSelect(e) {     const file = e.target.files[0];     if (!file) return;     const reader = new FileReader();     reader.onload = (ev) => {         currentFile = { name: file.name, type: file.type, data: ev.target.result, base64: ev.target.result.split(',')[1] };         document.getElementById('fileNameDisplay').textContent = file.name;         attachmentPreview.classList.add('active');         sendBtn.disabled = false;     };     if (file.type.startsWith('image/')) reader.readAsDataURL(file);     else reader.readAsText(file); } function clearAttachment() {     currentFile = null;     attachmentPreview.classList.remove('active');     fileInput.value = '';     sendBtn.disabled = !userInput.value.trim(); }  function renderSidebar() {     const list = document.getElementById('convList'); list.innerHTML = '';     const convs = chatData[activeUser] || {};     Object.keys(convs).sort().reverse().forEach(id => {         const item = document.createElement('div');         item.className = `conv-item ${id === currentConvId ? 'active' : ''}`;         item.onclick = () => selectConv(id);         item.innerHTML = `             <span style="overflow:hidden; text-overflow:ellipsis; white-space:nowrap; flex:1">${convs[id].title}</span>             <div class="conv-actions">                 <i class="fas fa-pen" onclick="renameConv('${id}', event)"></i>                 <i class="fas fa-trash" onclick="deleteConv('${id}', event)"></i>             </div>         `;         list.appendChild(item);     }); }  function selectConv(id) { currentConvId = id; renderSidebar(); renderChat(); suggestionArea.innerHTML = ""; } function newChat() {     currentConvId = 'c_' + Date.now();     chatData[activeUser][currentConvId] = { title: 'New chat', messages: [] };     save(); renderSidebar(); renderChat(); suggestionArea.innerHTML = ""; }  function setMode(m) {      currentMode = m;      document.querySelectorAll('.mode-opt').forEach(el => el.classList.remove('active'));     document.getElementById(`opt-${m}`)?.classList.add('active');     document.getElementById('modeStatus').textContent = `Mode: ${m}`;     toggleModes();  }  function toggleAuthMode() {     isSignup = !isSignup;     document.getElementById('authSubTitle').textContent = isSignup ? 'Join the circus' : 'Sign in';     document.getElementById('authSubmitBtn').textContent = isSignup ? 'Sign Up' : 'Enter'; } document.getElementById('authForm').onsubmit = (e) => {     e.preventDefault();     const u = document.getElementById('username').value.trim();     const p = document.getElementById('password').value.trim();     if (isSignup) { users[u] = p; localStorage.setItem(USERS_DB, JSON.stringify(users)); }     if (users[u] === p) {         activeUser = u; localStorage.setItem('dumbo_session', u);         if (!chatData[u]) chatData[u] = {};         initApp();     } else alert("Invalid credentials."); }; function logout() { localStorage.removeItem('dumbo_session'); location.reload(); } function initApp() {     document.getElementById('authOverlay').style.display = 'none';     document.getElementById('app').style.display = 'grid';     document.getElementById('userDisplay').textContent = activeUser;     renderSidebar();     const ids = Object.keys(chatData[activeUser]);     if (ids.length) selectConv(ids[0]); else newChat();     updateLimitDisplay(); }  userInput.oninput = function() { this.style.height = 'auto'; this.style.height = this.scrollHeight + 'px'; sendBtn.disabled = !this.value.trim() && !currentFile; }; userInput.onkeydown = (e) => { if(e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); handleSend(); } }; sendBtn.onclick = () => handleSend();  if (activeUser) initApp(); </script> </body> </html>